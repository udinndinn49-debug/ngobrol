<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Obrolin ajaa â€” Ruang Diskusi Tanpa Batas</title>
  <style>
    /* --- Reset & variables --- */
    :root{
      --bg:#f6f7fb; --card:#ffffff; --accent:#2563eb; --muted:#6b7280; --success:#10b981;
      --radius:12px; --shadow: 0 6px 20px rgba(16,24,40,0.08);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; background:var(--bg); color:#0f1724}

    /* --- Layout --- */
    .app{max-width:980px;margin:28px auto;padding:18px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#06b6d4);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    h1{font-size:18px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    /* top controls */
    .controls{display:flex;gap:8px;align-items:center}
    button, .btn{background:var(--accent);color:white;border:none;padding:10px 12px;border-radius:10px;cursor:pointer;box-shadow:var(--shadow)}
    .btn.secondary{background:transparent;color:var(--accent);border:1px solid rgba(37,99,235,0.12)}
    .icon-btn{background:transparent;border: none;padding:8px;border-radius:8px;cursor:pointer}

    /* main area */
    .grid{display:grid;grid-template-columns:260px 1fr;gap:18px;margin-top:18px}
    .card{background:var(--card);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow)}

    /* sidebar */
    .categories{display:flex;flex-direction:column;gap:8px}
    .cat{padding:8px 10px;border-radius:10px;cursor:pointer;color:var(--muted);display:flex;justify-content:space-between}
    .cat.active{background:rgba(37,99,235,0.08);color:var(--accent);font-weight:600}

    /* thread list */
    .thread{display:flex;gap:12px;padding:10px;border-radius:10px;align-items:flex-start}
    .thread:hover{background:rgba(15,23,36,0.02)}
    .meta{font-size:12px;color:var(--muted)}
    .dot{width:10px;height:10px;border-radius:50%;background:#e2e8f0}

    /* composer */
    textarea{width:100%;min-height:80px;padding:10px;border-radius:10px;border:1px solid #e6edf3;resize:vertical}
    input[type="text"]{width:100%;padding:8px;border-radius:8px;border:1px solid #e6edf3}

    /* thread view */
    .thread-title{font-size:18px;margin:0}
    .thread-actions{display:flex;gap:8px;align-items:center}
    .reply{margin-top:12px;padding:10px;border-radius:10px;border:1px solid #f1f5f9;background:#fbfdff}
    .reply .meta{font-size:12px}

    /* vote */
    .vote{display:flex;flex-direction:column;align-items:center;gap:6px;padding:6px 8px;border-radius:8px}
    .vote button{background:transparent;border:none;cursor:pointer}
    .votes-count{font-weight:700}

    /* profile */
    .profile{display:flex;gap:10px;align-items:center}
    .avatar{width:36px;height:36px;border-radius:10px;background:#f1f5f9;display:flex;align-items:center;justify-content:center;color:var(--muted);font-weight:700}

    /* notifications */
    .notif-badge{background:#ef4444;color:white;border-radius:10px;padding:4px 6px;font-size:12px}

    /* small screens */
    @media (max-width:800px){
      .grid{grid-template-columns:1fr;}
      .brand h1{font-size:16px}
      .logo{width:40px;height:40px}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">OA</div>
        <div>
          <h1>Obrolin ajaa</h1>
          <p class="lead">Ruang Diskusi Tanpa Batas</p>
        </div>
      </div>
      <div class="controls">
        <div class="profile" id="top-profile">
          <!-- login area populated by JS -->
        </div>
        <button class="icon-btn" id="notif-btn" title="Notifikasi">ðŸ”” <span id="notif-count" style="margin-left:6px"></span></button>
        <button class="btn" id="new-thread-btn">Buat Thread</button>
      </div>
    </header>

    <div class="grid">
      <aside class="card">
        <h3 style="margin-top:0">Kategori</h3>
        <div class="categories" id="categories"></div>
        <hr style="margin:12px 0">
        <div>
          <strong>Info</strong>
          <p style="color:var(--muted);font-size:13px">Demo: penyimpanan lokal (localStorage). Cocok untuk prototipe dan belajar.</p>
        </div>
      </aside>

      <main>
        <div class="card" id="composer-card">
          <div style="display:flex;gap:10px;align-items:flex-start">
            <div class="avatar" id="composer-avatar">G</div>
            <div style="flex:1">
              <input id="thread-title" placeholder="Judul thread..." />
              <div style="height:8px"></div>
              <textarea id="thread-body" placeholder="Tulis sesuatu untuk memulai diskusi..."></textarea>
              <div style="display:flex;gap:8px;justify-content:space-between;margin-top:8px;align-items:center">
                <select id="thread-category"></select>
                <div style="display:flex;gap:8px">
                  <button class="btn" id="post-thread">Posting</button>
                  <button class="btn secondary" id="clear-thread">Bersihkan</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div style="height:14px"></div>

        <div id="threads-list"></div>
      </main>
    </div>

    <!-- Modal area -->
    <div id="modal-root"></div>
  </div>

  <script>
    // ======= Simple local-storage forum implementation =======
    // Data shapes saved in localStorage under 'obrolin_data'
    const DEFAULT_CATS = ['Teknologi','Lifestyle','Edukasi','Hiburan','Umum'];

    function loadData(){
      const raw = localStorage.getItem('obrolin_data');
      if(raw) return JSON.parse(raw);
      const data = {users:[], threads:[], notifications:[]};
      localStorage.setItem('obrolin_data',JSON.stringify(data));
      return data;
    }
    function saveData(d){ localStorage.setItem('obrolin_data',JSON.stringify(d)); }

    let data = loadData();
    let currentUser = JSON.parse(localStorage.getItem('obrolin_currentUser') || 'null');
    const modalRoot = document.getElementById('modal-root');

    // ===== UI helpers =====
    function el(html){ const div=document.createElement('div'); div.innerHTML=html.trim(); return div.firstChild; }

    // ===== Auth (very simple demo) =====
    function renderTopProfile(){
      const root = document.getElementById('top-profile'); root.innerHTML='';
      if(currentUser){
        const prof = el(`<div style="display:flex;gap:8px;align-items:center"><div class="avatar">${currentUser.name[0].toUpperCase()}</div><div style="text-align:right"><div style="font-size:13px">${currentUser.name}</div><div style="font-size:12px;color:var(--muted)">${currentUser.email}</div></div><button class="btn secondary" id="logout">Keluar</button></div>`);
        root.appendChild(prof);
        prof.querySelector('#logout').onclick = ()=>{ currentUser=null; localStorage.removeItem('obrolin_currentUser'); renderTopProfile(); renderComposer(); renderThreads(); }
      } else {
        const login = el(`<div style="display:flex;gap:6px;align-items:center"><button class="btn" id="open-login">Masuk / Daftar</button></div>`);
        root.appendChild(login);
        login.querySelector('#open-login').onclick = openAuthModal;
      }
    }

    function openAuthModal(){
      showModal(`<div style="max-width:420px"><h3>Masuk atau Daftar</h3>
        <div style="display:grid;gap:8px;margin-top:8px">
          <input id="auth-name" placeholder="Nama (untuk daftar)" />
          <input id="auth-email" placeholder="Email" />
          <input id="auth-pass" placeholder="Kata sandi" type="password" />
          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
            <button class="btn secondary" id="close-auth">Tutup</button>
            <button class="btn" id="do-signup">Daftar</button>
            <button class="btn" id="do-login">Masuk</button>
          </div>
        </div>
      </div>`);

      document.getElementById('close-auth').onclick = closeModal;
      document.getElementById('do-signup').onclick = ()=>{
        const name = document.getElementById('auth-name').value.trim();
        const email = document.getElementById('auth-email').value.trim();
        const pass = document.getElementById('auth-pass').value;
        if(!name || !email || !pass){ alert('Isi semua kolom untuk daftar.'); return; }
        if(data.users.find(u=>u.email===email)){ alert('Email sudah terdaftar. Silakan masuk.'); return; }
        const user = {id:Date.now().toString(),name,email,pass,joined:new Date().toISOString()};
        data.users.push(user); saveData(data); currentUser=user; localStorage.setItem('obrolin_currentUser',JSON.stringify(currentUser)); closeModal(); renderTopProfile(); renderComposer(); renderThreads();
      }
      document.getElementById('do-login').onclick = ()=>{
        const email = document.getElementById('auth-email').value.trim();
        const pass = document.getElementById('auth-pass').value;
        const user = data.users.find(u=>u.email===email && u.pass===pass);
        if(!user){ alert('Email atau kata sandi salah.'); return; }
        currentUser = user; localStorage.setItem('obrolin_currentUser',JSON.stringify(currentUser)); closeModal(); renderTopProfile(); renderComposer(); renderThreads();
      }
    }

    // ===== Modal helpers =====
    function showModal(inner){
      modalRoot.innerHTML = `<div style="position:fixed;inset:0;background:rgba(2,6,23,0.45);display:flex;align-items:center;justify-content:center;padding:16px;z-index:999"><div style="max-width:96%;width:640px">${inner}<div style="height:6px"></div></div></div>`;
    }
    function closeModal(){ modalRoot.innerHTML=''; }

    // ===== categories =====
    function renderCategories(active='Semua'){
      const root = document.getElementById('categories'); root.innerHTML='';
      const cats = ['Semua',...DEFAULT_CATS];
      cats.forEach(c=>{
        const d = el(`<div class="cat ${c===active? 'active':''}" data-cat="${c}">${c} <span style="color:var(--muted)"></span></div>`);
        d.onclick = ()=>{ renderCategories(c); renderThreads(c); document.getElementById('thread-category').value = (DEFAULT_CATS.includes(c)?c:DEFAULT_CATS[0]); }
        root.appendChild(d);
      })
    }

    // ===== composer =====
    function renderComposer(){
      document.getElementById('composer-avatar').textContent = currentUser? currentUser.name[0].toUpperCase(): 'G';
      const sel = document.getElementById('thread-category'); sel.innerHTML=''; DEFAULT_CATS.forEach(c=>{ const opt=document.createElement('option'); opt.value=c; opt.textContent=c; sel.appendChild(opt);});
      document.getElementById('post-thread').onclick = postThread;
      document.getElementById('clear-thread').onclick = ()=>{ document.getElementById('thread-title').value=''; document.getElementById('thread-body').value=''; }
    }

    function postThread(){
      if(!currentUser){ openAuthModal(); return; }
      const title = document.getElementById('thread-title').value.trim();
      const body = document.getElementById('thread-body').value.trim();
      const category = document.getElementById('thread-category').value;
      if(!title || !body){ alert('Judul dan isi thread wajib diisi.'); return; }
      const thread = {id:Date.now().toString(),title,body,category,authorId:currentUser.id,authorName:currentUser.name,created:new Date().toISOString(),votes:0,replies:[]};
      data.threads.unshift(thread); saveData(data); renderThreads(); document.getElementById('thread-title').value=''; document.getElementById('thread-body').value='';
    }

    // ===== threads list & view =====
    function renderThreads(filter='Semua'){
      const list = document.getElementById('threads-list'); list.innerHTML='';
      const threads = data.threads.filter(t=> filter==='Semua' || t.category===filter);
      if(threads.length===0) list.innerHTML = '<div class="card">Belum ada thread. Jadilah yang pertama!</div>';
      threads.forEach(t=>{
        const item = el(`<div class="card thread"><div style="display:flex;gap:12px;align-items:center"><div class="vote"><button class="up">â–²</button><div class="votes-count">${t.votes}</div><button class="down">â–¼</button></div></div><div style="flex:1"><div style="display:flex;justify-content:space-between;align-items:start"><div><div style="font-weight:700">${escapeHtml(t.title)}</div><div class="meta">oleh ${escapeHtml(t.authorName)} â€¢ ${new Date(t.created).toLocaleString()}</div></div><div class="meta">${escapeHtml(t.category)}</div></div><div style="margin-top:8px;color:var(--muted);">${escapeHtml(truncate(t.body,200))}</div><div style="margin-top:10px;display:flex;gap:8px"><button class="btn" data-id="${t.id}" data-action="open">Buka</button><button class="btn secondary" data-id="${t.id}" data-action="share">Bagikan</button></div></div></div>`);
        list.appendChild(item);
        item.querySelector('[data-action=open]').onclick = ()=>openThread(t.id);
        item.querySelector('[data-action=share]').onclick = ()=>{ navigator.clipboard?.writeText(window.location.href + '#t=' + t.id).then(()=>alert('Link disalin ke clipboard')) }
        const up = item.querySelector('.up'), down = item.querySelector('.down'), vc = item.querySelector('.votes-count');
        up.onclick = ()=>{ t.votes++; vc.textContent=t.votes; saveData(data); }
        down.onclick = ()=>{ t.votes--; vc.textContent=t.votes; saveData(data); }
      })
      updateNotifUI();
    }

    function openThread(id){
      const t = data.threads.find(x=>x.id===id); if(!t) return;
      let html = `<div style="max-width:820px">
        <div style="display:flex;gap:12px;align-items:flex-start"><div class="vote"><div style="font-size:20px">${t.votes}</div></div><div style="flex:1"><h2 class="thread-title">${escapeHtml(t.title)}</h2><div class="meta">oleh ${escapeHtml(t.authorName)} â€¢ ${new Date(t.created).toLocaleString()} â€¢ ${escapeHtml(t.category)}</div><div style="height:12px"></div><div style="white-space:pre-wrap">${escapeHtml(t.body)}</div>
        <div style="margin-top:12px;display:flex;gap:8px"><button class="btn" id="reply-btn">Balas</button><button class="btn secondary" id="close-thread">Tutup</button></div>
        </div></div>
        <hr style="margin:12px 0"><div id="replies-root"></div>
        <div style="height:10px"></div>
        <div class="card"><div style="display:flex;gap:10px"><div class="avatar">${t.authorName[0].toUpperCase()}</div><div style="flex:1"><textarea id="reply-body" placeholder="Tulis balasan..."></textarea><div style="display:flex;justify-content:flex-end;margin-top:8px"><button class="btn" id="post-reply">Kirim Balasan</button></div></div></div></div>
      </div>`;
      showModal(html);

      renderReplies(t);
      document.getElementById('close-thread').onclick = closeModal;
      document.getElementById('post-reply').onclick = ()=>{
        if(!currentUser){ closeModal(); openAuthModal(); return; }
        const body = document.getElementById('reply-body').value.trim(); if(!body){ alert('Tulis pesan terlebih dahulu'); return; }
        const reply = {id:Date.now().toString(),authorId:currentUser.id,authorName:currentUser.name,body,created:new Date().toISOString(),replies:[],votes:0,parentId:null};
        t.replies.push(reply); saveData(data); renderReplies(t); notifyAuthorIfNeeded(t, reply); updateNotifUI(); document.getElementById('reply-body').value='';
      }
    }

    function renderReplies(thread){
      const root = document.getElementById('replies-root'); root.innerHTML='';
      function renderList(list, container, depth){
        list.forEach(r=>{
          const rep = document.createElement('div'); rep.className='reply'; rep.style.marginLeft = (depth*12)+'px';
          rep.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>${escapeHtml(r.authorName)}</strong><div class="meta">${new Date(r.created).toLocaleString()}</div></div><div class="meta">Votes: <span>${r.votes}</span></div></div><div style="margin-top:8px;white-space:pre-wrap">${escapeHtml(r.body)}</div><div style="margin-top:8px;display:flex;gap:8px"><button class="btn small" data-id="${r.id}" data-action="reply">Balas</button><button class="btn secondary" data-id="${r.id}" data-action="up">Upvote</button><button class="btn secondary" data-id="${r.id}" data-action="down">Downvote</button></div>`;
          container.appendChild(rep);
          rep.querySelector('[data-action=reply]').onclick = ()=>{
            const box = document.createElement('div'); box.style.marginTop='8px'; box.innerHTML = `<textarea placeholder="Balas..." style="width:100%;min-height:60px"></textarea><div style="display:flex;justify-content:flex-end;margin-top:6px"><button class="btn">Kirim</button></div>`;
            rep.appendChild(box);
            box.querySelector('button').onclick = ()=>{
              if(!currentUser){ alert('Silakan masuk untuk membalas.'); return; }
              const txt = box.querySelector('textarea').value.trim(); if(!txt) return; const newR = {id:Date.now().toString(),authorId:currentUser.id,authorName:currentUser.name,body:txt,created:new Date().toISOString(),replies:[],votes:0,parentId:r.id};
              r.replies.push(newR); saveData(data); renderReplies(thread); notifyAuthorIfNeeded(thread, newR); updateNotifUI();
            }
          }
          rep.querySelector('[data-action=up]').onclick = ()=>{ r.votes++; saveData(data); renderReplies(thread); }
          rep.querySelector('[data-action=down]').onclick = ()=>{ r.votes--; saveData(data); renderReplies(thread); }
          if(r.replies && r.replies.length) renderList(r.replies, container, depth+1);
        })
      }
      renderList(thread.replies, root, 0);
    }

    // ===== notifications (local) =====
    function notifyAuthorIfNeeded(thread, reply){
      if(thread.authorId && thread.authorId !== currentUser?.id){
        const notif = {id:Date.now().toString(),userId:thread.authorId,threadId:thread.id,threadTitle:thread.title,from:reply.authorName,created:new Date().toISOString(),read:false};
        data.notifications.push(notif); saveData(data);
      }
    }
    function updateNotifUI(){
      const btn = document.getElementById('notif-btn'); const span = document.getElementById('notif-count');
      if(!currentUser){ span.textContent=''; btn.onclick = ()=>{ openAuthModal(); } ; return; }
      const unread = data.notifications.filter(n=>n.userId===currentUser.id && !n.read).length;
      span.innerHTML = unread? `<span class="notif-badge">${unread}</span>` : '';
      btn.onclick = ()=>{ openNotifPanel(); }
    }
    function openNotifPanel(){
      if(!currentUser) return openAuthModal();
      const nots = data.notifications.filter(n=>n.userId===currentUser.id).sort((a,b)=>b.created.localeCompare(a.created));
      let html = `<div style="max-width:420px"><h3>Notifikasi (${nots.length})</h3><div style="display:flex;flex-direction:column;gap:8px">`;
      nots.forEach(n=>{ html += `<div style="padding:8px;border-radius:8px;background:${n.read? '#fff':'#eef2ff'}"><div style="font-weight:700">${escapeHtml(n.from)}</div><div style="color:var(--muted);font-size:13px">Membalas thread: ${escapeHtml(n.threadTitle)}</div><div style="font-size:12px;color:var(--muted)">${new Date(n.created).toLocaleString()}</div></div>` });
      html += `</div><div style="display:flex;justify-content:flex-end;margin-top:10px"><button class="btn" id="mark-read">Tandai sudah dibaca</button><button class="btn secondary" id="close-notif">Tutup</button></div></div>`;
      showModal(html);
      document.getElementById('close-notif').onclick = closeModal;
      document.getElementById('mark-read').onclick = ()=>{ data.notifications.forEach(n=>{ if(n.userId===currentUser.id) n.read=true; }); saveData(data); closeModal(); updateNotifUI(); }
    }

    // ===== utilities =====
    function escapeHtml(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
    function truncate(s,n){ return s.length>n? s.slice(0,n-1)+'â€¦': s; }

    // ===== bootstrap =====
    document.getElementById('new-thread-btn').onclick = ()=>{ window.scrollTo({top:0,behavior:'smooth'}); document.getElementById('thread-title').focus(); }
    document.getElementById('notif-count').textContent='';
    renderTopProfile(); renderComposer(); renderCategories(); renderThreads(); updateNotifUI();

    // Provide deep-link support: #t=threadid
    if(window.location.hash.startsWith('#t=')){ const id = window.location.hash.split('=')[1]; setTimeout(()=>openThread(id),600); }

    // expose for debugging
    window._obrolin = {data,saveData,loadData};
  </script>
</body>
</html>
